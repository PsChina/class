<!DOCTYPE html>
<html ng-app="app">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style lang="">
        .footer{
            position: absolute;
            left: 0;
            bottom: 0;
            height: 100px;
            width: 100%;
        }
        .footer a{
            float: left;
            text-align: center;
            line-height: 100px;
            width: 33%;
        }
        .content{
            position: absolute;
            left: 0;
            top: 0;
            bottom: 100px;
            right: 0;
            width: 100%;
        }
        .active{
            background: red;
        }
    </style>
</head>
<body ng-controller="main">


    <ng-view class="content"></ng-view> <!-- 自定义指令 里面 restrict:'E'  -->
    <!-- 这是一个容器 用来显示 when 方法内template的内容 -->
    <div class="footer">
        <a href="#!/home" ng-class="{ active: path === '/home' }">主页</a>
        <a href="#!/about" ng-class="{ active: path === '/about' }">关于</a>
        <a href="#!/me" ng-class="{ active: path === '/me' }">我</a>           
    </div>

</body>
<script src="./angular.js"></script>
<script src="./angular-route.js"></script>
</html>
<script>
    // 多页面 管理
    angular.module('app',['ngRoute']) // 依赖注入 路由
            .run(['$rootScope',function($rootScope){
                $rootScope.$on('$routeChangeSuccess',function(event,currentRoute,preRoute){
                    $rootScope.path = currentRoute.$$route.originalPath;
                })
            }])
            .config( ['$routeProvider',function($routeProvider){
                $routeProvider.when('/home',{
                    template:'<div> <div  ng-bind="data"></div> <div ng-bind="home.content.value.myData"></div> </div>',
                    controller:['$scope','$http','getData',function($scope,$http,getData){ // 匿名控制器
                        $scope.data = '主页主页主页'
                        this.content = getData()
                    }],
                    controllerAs:'home',
                    // redirectTo:'/about', // 当你点击 home 页面的时候 他不会跳到 home 页面 只会跳到 about
                    resolve:{  // 解决器 这是一个局部服务 只能在当前路由使用的一个服务
                        getData:['$http','$q',function($http,$q){ // 帮我们请求数据
                            return function(){
                                var defer = $q.defer() // 等待中
                                $http({
                                    url:'http://localhost:8080/json.json',
                                    method:'GET'
                                })
                                .then(function(result){
                                    console.log(result.data);
                                    defer.resolve(result.data); // 已成功
                                },function(error){
                                    defer.reject(error); // 已失败
                                    throw new Error(error);
                                })
                                return defer.promise.$$state;                                
                            }
                        }]
                    }
                })
                .when('/about',{
                    template:'<div>关于我们</div>'
                })
                .when('/me',{
                    template:'<div>我的个人信息</div>'
                })
            }] )
            .controller('main',['$scope',function($scope){
                $scope.msg = 'Hello World!';
            }])

</script>